<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ç–æ—Ä –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã ‚Äî Pro</title>
<style>
  :root{
    --bg:#f3fbf5;
    --card:#ffffff;
    --ink:#1f3b2e;
    --muted:#5a7a68;
    --brand:#2e7d32;
    --brand-2:#43a047;
    --brand-3:#66bb6a;
    --accent:#a5d6a7;
    --keycap:#31b67a;
    --switch:#2f9e76;
    --base:#227a57;
    --ring: 0 0 0 3px rgba(67,160,71,.25);
    --shadow: 0 12px 30px rgba(0,0,0,.08);
    --shadow-sm: 0 6px 18px rgba(0,0,0,.06);
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
    background: var(--bg);
    color:var(--ink);
    line-height:1.45;
  }

  /* ===== Header / Hero Buttons ===== */
  header{
    padding:28px 16px 10px;
  }
  h1{
    margin:0 0 14px;
    text-align:center;
    font-size: clamp(24px, 3vw, 32px);
    font-weight:800;
    letter-spacing:.3px;
  }
  .subtitle{
    text-align:center;
    color:var(--muted);
    margin-bottom:18px;
    font-size:14px;
  }
  .menu{
    display:flex;
    gap:14px;
    justify-content:center;
    flex-wrap:wrap;
    padding:0 10px 8px;
  }
  .menu .pill{
    display:flex; align-items:center; gap:10px;
    border:none; cursor:pointer; color:#fff;
    padding:14px 18px; border-radius:14px;
    box-shadow: var(--shadow-sm);
    transition: transform .15s ease, filter .15s ease;
    font-weight:700; letter-spacing:.2px;
  }
  .pill:hover{ transform: translateY(-1px); filter: brightness(1.05); }
  .pill:focus-visible{ outline:none; box-shadow: var(--ring); }
  .pill .icon{ font-size:18px; opacity:.95 }

  .pill.keycaps{ background: linear-gradient(135deg, var(--keycap), #77d9ac); }
  .pill.switches{ background: linear-gradient(135deg, var(--switch), #6fd9b8); }
  .pill.bases{ background: linear-gradient(135deg, var(--base), #57c59a); }
  .pill.delivery{ background: linear-gradient(135deg, var(--brand), var(--brand-2)); }
  .pill.cart{ background: linear-gradient(135deg, #1b5e20, #43a047); }

  /* ===== Sections / Blocks ===== */
  .container{ width:min(1100px, 94vw); margin:0 auto 24px; }

  .block{ display:none; }
  .block.active{ display:block; animation: fadeIn .25s ease; }
  @keyframes fadeIn{ from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:none} }

  .grid{
    display:grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap:14px;
  }
  @media (max-width:900px){
    .grid{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
  }
  @media (max-width:560px){
    .grid{ grid-template-columns: 1fr; }
  }

  /* ===== Item Card ===== */
  .card{
    background: var(--card);
    border-radius:16px;
    box-shadow: var(--shadow);
    overflow:hidden;
    transition: transform .18s ease, box-shadow .18s ease;
    position:relative;
  }
  .card:hover{ transform: translateY(-3px); box-shadow: 0 14px 34px rgba(0,0,0,.12); }
  .card-media{
    background:#f6fff9; display:grid; place-items:center;
    aspect-ratio: 1 / 1; overflow:hidden;
  }
  .card-media img{ width:100%; height:100%; object-fit:contain; display:block; }
  .badge{
    position:absolute; top:10px; left:10px;
    color:#fff; font-size:12px; padding:6px 10px; border-radius:999px; font-weight:700;
    letter-spacing:.2px; box-shadow: var(--shadow-sm);
  }
  .badge.keycap{ background: var(--keycap); }
  .badge.switch{ background: var(--switch); }
  .badge.base{ background: var(--base); }

  .price-tag{
    position:absolute; top:10px; right:10px;
    background: rgba(0,0,0,.75); color:#fff; font-size:13px; padding:6px 10px;
    border-radius:10px; font-weight:700; letter-spacing:.2px;
  }
  .card-body{ padding:12px 14px; display:flex; justify-content:space-between; align-items:center; gap:8px; }
  .card-title{ font-weight:800; font-size:15px; }
  .card-cta{
    border:none; background:#e8f5e9; color:var(--brand);
    font-weight:800; padding:8px 12px; border-radius:10px; cursor:pointer;
    transition: background .15s ease, transform .15s ease;
  }
  .card-cta:hover{ background:#d8f0da; transform: translateY(-1px); }
  .card-cta:focus-visible{ outline:none; box-shadow: var(--ring); }

  /* ===== Order Summary ===== */
  .order{
    background: var(--card);
    border-radius:18px;
    box-shadow: var(--shadow);
    padding:18px;
    margin: 18px auto 30px;
  }
  .order h3{ margin:0 0 12px; font-size:18px; }
  .order-line{
    display:flex; gap:16px; align-items:center; justify-content:center; flex-wrap:wrap;
  }
  .order-line .mini{
    width:110px; height:110px; border:1px solid #e6efe8; border-radius:12px;
    display:grid; place-items:center; background:#f7fff8; overflow:hidden;
  }
  .order-line img{ width:100%; height:100%; object-fit:contain; }
  .order-total{
    margin-top:12px; text-align:center; font-weight:900; font-size:20px;
  }

  /* ===== Delivery & Payment ===== */
  .dp{
    background: var(--card);
    border-radius:18px;
    box-shadow: var(--shadow);
    padding:18px;
  }
  .dp h4{ margin:0 0 12px; font-size:18px; }
  .dp-row{ display:grid; grid-template-columns: 1fr 1fr; gap:16px; }
  @media (max-width:720px){ .dp-row{ grid-template-columns: 1fr; } }
  .dp .group{
    border:1px solid #e6efe8; border-radius:14px; padding:12px 14px;
    background: #f9fffb;
  }
  .dp label{ font-weight:700; display:block; margin-bottom:8px; }
  .dp select{ width:100%; padding:10px 12px; border-radius:10px; border:1px solid #d9e7dc; background:#fff; }
  .pay-row{ display:flex; gap:16px; align-items:center; flex-wrap:wrap; }
  .pay-row .opt{
    display:flex; align-items:center; gap:8px; background:#fff; border:1px solid #d9e7dc; padding:8px 12px; border-radius:10px;
  }

  /* ===== Modal (Gallery & Switch) ===== */
  .modal{
    position:fixed; inset:0; background: rgba(0,0,0,.55);
    display:none; place-items:center; z-index:1000;
  }
  .modal.active{ display:grid; }
  .dialog{
    width:min(560px, 92vw); background: var(--card); border-radius:18px; box-shadow: var(--shadow);
    padding:16px 16px 18px; position:relative;
  }
  .close-btn{
    position:absolute; right:10px; top:10px; border:none; background:#edf7ef; color:var(--ink);
    width:36px; height:36px; border-radius:999px; cursor:pointer; font-size:18px; font-weight:800;
  }
  .close-btn:hover{ filter: brightness(1.03); }
  .gallery{
    position:relative; background:#f6fff9; border-radius:14px; overflow:hidden; display:grid; place-items:center;
    aspect-ratio: 1 / 1;
  }
  .gallery img{ width:100%; height:100%; object-fit:contain; user-select:none; }
  .arrow{
    position:absolute; top:50%; transform: translateY(-50%);
    width:42px; height:42px; border-radius:999px; border:none; cursor:pointer;
    background: rgba(0,0,0,.55); color:#fff; font-size:18px; display:grid; place-items:center;
  }
  .arrow.left{ left:10px; }
  .arrow.right{ right:10px; }
  .modal-body{ padding:12px 2px 0; }
  .modal-title{ font-size:18px; font-weight:900; margin:6px 0 4px; }
  .modal-meta{ color:var(--muted); font-size:14px; margin-bottom:8px; }
  .modal-actions{ display:flex; gap:10px; align-items:center; justify-content:center; padding-top:6px; }
  .btn-primary{
    background: linear-gradient(135deg, var(--brand), var(--brand-2));
    border:none; color:#fff; font-weight:800; padding:10px 14px; border-radius:12px; cursor:pointer;
  }
  .btn-primary:hover{ filter: brightness(1.05); }
  .btn-ghost{
    background:#edf7ef; color:var(--brand); border:none; font-weight:800; padding:10px 12px; border-radius:12px; cursor:pointer;
  }
  .btn-ghost:hover{ filter: brightness(1.02); }

  /* Helper: visually-hidden for labels */
  .visually-hidden{ position:absolute!important; height:1px; width:1px; overflow:hidden; clip:rect(1px,1px,1px,1px); white-space:nowrap; }
</style>
</head>
<body>

<header class="container">
  <h1>–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ç–æ—Ä –∫–∞—Å—Ç–æ–º–Ω–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã</h1>
  <p class="subtitle">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–ø–ª–µ–∫—Ç—É—é—â–∏–µ, –ø—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –¥–µ—Ç–∞–ª–∏ –∏ –æ—Ñ–æ—Ä–º–∏—Ç–µ –∑–∞–∫–∞–∑</p>
  <div class="menu" role="navigation" aria-label="–û—Å–Ω–æ–≤–Ω–æ–µ –º–µ–Ω—é">
    <button class="pill keycaps" data-block="keycaps-block"><span class="icon">üé®</span> –ö–µ–π–∫–∞–ø—ã</button>
    <button class="pill switches" data-block="switches-block"><span class="icon">üéõÔ∏è</span> –°–≤–∏—Ç—á–∏</button>
    <button class="pill bases" data-block="bases-block"><span class="icon">‚å®Ô∏è</span> –û—Å–Ω–æ–≤—ã</button>
    <button class="pill delivery" data-block="delivery-block"><span class="icon">üöö</span> –î–æ—Å—Ç–∞–≤–∫–∞ –∏ –æ–ø–ª–∞—Ç–∞</button>
    <button class="pill cart" id="open-cart"><span class="icon">üõí</span> –ö–æ—Ä–∑–∏–Ω–∞</button>
  </div>
</header>

<main class="container">

  <!-- –°–µ—Ç–∫–∏ -->
  <section id="keycaps-block" class="block"></section>
  <section id="switches-block" class="block"></section>
  <section id="bases-block" class="block"></section>

  <!-- –§–∏–Ω–∞–ª—å–Ω—ã–π –∑–∞–∫–∞–∑ -->
  <section id="order-summary" class="order">
    <h3>–í–∞—à –∑–∞–∫–∞–∑</h3>
    <div class="order-line">
      <div class="mini"><img id="order-keycap" alt="–ö–µ–π–∫–∞–ø (–ø—Ä–µ–≤—å—é)" loading="lazy" /></div>
      <div class="mini"><img id="order-switch" alt="–°–≤–∏—Ç—á (–ø—Ä–µ–≤—å—é)" loading="lazy" /></div>
      <div class="mini"><img id="order-base" alt="–û—Å–Ω–æ–≤–∞ (–ø—Ä–µ–≤—å—é)" loading="lazy" /></div>
    </div>
    <div class="order-total" id="order-total">–ò—Ç–æ–≥: 0 ‚ÇΩ</div>
  </section>

  <!-- –î–æ—Å—Ç–∞–≤–∫–∞ –∏ –æ–ø–ª–∞—Ç–∞ -->
  <section id="delivery-block" class="block dp">
    <h4>–î–æ—Å—Ç–∞–≤–∫–∞ –∏ –æ–ø–ª–∞—Ç–∞</h4>
    <div class="dp-row">
      <div class="group">
        <label for="delivery">–°–ø–æ—Å–æ–± –¥–æ—Å—Ç–∞–≤–∫–∏</label>
        <select id="delivery" aria-label="–í—ã–±–µ—Ä–∏—Ç–µ –¥–æ—Å—Ç–∞–≤–∫—É">
          <option value="300">–°–î–≠–ö –∏–∑ –°–ü–± ‚Äî 300 ‚ÇΩ</option>
          <option value="500">–ö—É—Ä—å–µ—Ä ‚Äî 500 ‚ÇΩ</option>
          <option value="0">–°–∞–º–æ–≤—ã–≤–æ–∑ ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω–æ</option>
        </select>
      </div>
      <div class="group">
        <span class="visually-hidden" id="pay-legend">–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã</span>
        <div class="pay-row" role="group" aria-labelledby="pay-legend">
          <label class="opt"><input type="radio" name="payment" value="crypto" checked /> –ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞</label>
          <label class="opt"><input type="radio" name="payment" value="sbp" /> –°–ë–ü</label>
          <label class="opt"><input type="radio" name="payment" value="card" /> –ö–∞—Ä—Ç–∞</label>
        </div>
      </div>
    </div>
  </section>

</main>

<!-- –ú–æ–¥–∞–ª–∫–∞: –≥–∞–ª–µ—Ä–µ—è (–∫–µ–π–∫–∞–ø—ã/–æ—Å–Ω–æ–≤—ã) + –º–æ–¥–∞–ª–∫–∞ —Å–≤–∏—Ç—á–µ–π -->
<div id="modal" class="modal" aria-modal="true" role="dialog" aria-labelledby="modal-title">
  <div class="dialog">
    <button class="close-btn" id="modal-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>

    <div class="gallery" id="gallery">
      <button class="arrow left" id="prev-btn" aria-label="–ü—Ä–µ–¥—ã–¥—É—â–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">‚Äπ</button>
      <img id="modal-img" alt="–ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ–≤–∞—Ä–∞" />
      <button class="arrow right" id="next-btn" aria-label="–°–ª–µ–¥—É—é—â–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">‚Ä∫</button>
    </div>

    <div class="modal-body">
      <div id="modal-title" class="modal-title"></div>
      <div id="modal-meta" class="modal-meta"></div>
      <div class="modal-actions">
        <button id="modal-add" class="btn-primary">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É</button>
        <button id="modal-sound" class="btn-ghost" style="display:none;">üîä –ü—Ä–æ—Å–ª—É—à–∞—Ç—å –∑–≤—É–∫</button>
      </div>
    </div>
  </div>
</div>

<!-- "–ö–æ—Ä–∑–∏–Ω–∞" –∫–∞–∫ –±—ã—Å—Ç—Ä—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–∫—É—â–µ–≥–æ –≤—ã–±–æ—Ä–∞ (—Ç–æ—Ç –∂–µ –∏—Ç–æ–≥, –Ω–æ –≤–æ –≤—Å–ø–ª—ã–≤–∞—à–∫–µ) -->
<div id="cart" class="modal" aria-modal="true" role="dialog" aria-labelledby="cart-title">
  <div class="dialog">
    <button class="close-btn" id="cart-close" aria-label="–ó–∞–∫—Ä—ã—Ç—å">√ó</button>
    <h3 id="cart-title" class="modal-title">–ö–æ—Ä–∑–∏–Ω–∞</h3>
    <div class="order-line" style="margin-top:10px;">
      <div class="mini"><img id="cart-keycap" alt="–ö–µ–π–∫–∞–ø –≤ –∫–æ—Ä–∑–∏–Ω–µ"/></div>
      <div class="mini"><img id="cart-switch" alt="–°–≤–∏—Ç—á –≤ –∫–æ—Ä–∑–∏–Ω–µ"/></div>
      <div class="mini"><img id="cart-base" alt="–û—Å–Ω–æ–≤–∞ –≤ –∫–æ—Ä–∑–∏–Ω–µ"/></div>
    </div>
    <div class="order-total" id="cart-total" style="margin-top:14px;">–ò—Ç–æ–≥: 0 ‚ÇΩ</div>
  </div>
</div>

<script>
  /* =================== DATA (6 —à—Ç—É–∫ –≤ –∫–∞–∂–¥–æ–º –±–ª–æ–∫–µ) =================== */
  const data = {
    keycaps: [
      {id:1, name:"–ö–µ–π–∫–∞–ø #1", images:["https://picsum.photos/seed/kc1a/600/600","https://picsum.photos/seed/kc1b/600/600","https://picsum.photos/seed/kc1c/600/600"], price:1200, desc:"PBT, –ø—Ä–æ—Ñ–∞–π–ª Cherry"},
      {id:2, name:"–ö–µ–π–∫–∞–ø #2", images:["https://picsum.photos/seed/kc2a/600/600","https://picsum.photos/seed/kc2b/600/600","https://picsum.photos/seed/kc2c/600/600"], price:1350, desc:"ABS, –ø—Ä–æ—Ñ–∞–π–ª OEM"},
      {id:3, name:"–ö–µ–π–∫–∞–ø #3", images:["https://picsum.photos/seed/kc3a/600/600","https://picsum.photos/seed/kc3b/600/600","https://picsum.photos/seed/kc3c/600/600"], price:1500, desc:"PBT, –æ–∫—Ä–∞—Å–∫–∞ Dye-sub"},
      {id:4, name:"–ö–µ–π–∫–∞–ø #4", images:["https://picsum.photos/seed/kc4a/600/600","https://picsum.photos/seed/kc4b/600/600","https://picsum.photos/seed/kc4c/600/600"], price:1100, desc:"PBT, —Ç–µ–∫—Å—Ç—É—Ä–∞ –º–∞—Ç–æ–≤–∞—è"},
      {id:5, name:"–ö–µ–π–∫–∞–ø #5", images:["https://picsum.photos/seed/kc5a/600/600","https://picsum.photos/seed/kc5b/600/600","https://picsum.photos/seed/kc5c/600/600"], price:1450, desc:"ABS, –¥–≤—É—Å–ª–æ–π–Ω–∞—è –ª–µ–≥–µ–Ω–¥–∞"},
      {id:6, name:"–ö–µ–π–∫–∞–ø #6", images:["https://picsum.photos/seed/kc6a/600/600","https://picsum.photos/seed/kc6b/600/600","https://picsum.photos/seed/kc6c/600/600"], price:1600, desc:"PBT, –ø—Ä–æ—Ñ–∞–π–ª XDA"}
    ],
    switches: [
      {id:1, name:"–°–≤–∏—Ç—á #1", img:"https://picsum.photos/seed/sw1/600/600", price:500, sound:"https://actions.google.com/sounds/v1/impacts/mechanical_plastic_impact.ogg", desc:"–õ–∏–Ω–µ–π–Ω—ã–π, 45–≥"},
      {id:2, name:"–°–≤–∏—Ç—á #2", img:"https://picsum.photos/seed/sw2/600/600", price:540, sound:"https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg", desc:"–¢–∞–∫—Ç–∏–ª—å–Ω—ã–π, 50–≥"},
      {id:3, name:"–°–≤–∏—Ç—á #3", img:"https://picsum.photos/seed/sw3/600/600", price:520, sound:"https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg", desc:"–ö–ª–∏–∫–∞—é—â–∏–π, 60–≥"},
      {id:4, name:"–°–≤–∏—Ç—á #4", img:"https://picsum.photos/seed/sw4/600/600", price:530, sound:"https://actions.google.com/sounds/v1/tools/squeaky_toy.ogg", desc:"–õ–∏–Ω–µ–π–Ω—ã–π, 40–≥"},
      {id:5, name:"–°–≤–∏—Ç—á #5", img:"https://picsum.photos/seed/sw5/600/600", price:590, sound:"https://actions.google.com/sounds/v1/cartoon/concussive_hit_guitar_boing.ogg", desc:"–¢–∞–∫—Ç–∏–ª—å–Ω—ã–π, 55–≥"},
      {id:6, name:"–°–≤–∏—Ç—á #6", img:"https://picsum.photos/seed/sw6/600/600", price:560, sound:"https://actions.google.com/sounds/v1/cartoon/metal_clang_and_wobble.ogg", desc:"–ö–ª–∏–∫–∞—é—â–∏–π, 58–≥"}
    ],
    bases: [
      {id:1, name:"–û—Å–Ω–æ–≤–∞ #1", images:["https://picsum.photos/seed/bs1a/600/600","https://picsum.photos/seed/bs1b/600/600","https://picsum.photos/seed/bs1c/600/600"], price:7000, material:"–ê–ª—é–º–∏–Ω–∏–π", os:"Windows, macOS", connection:"–ü—Ä–æ–≤–æ–¥–Ω–æ–µ", battery:"‚Äî", desc:"65%, hotswap"},
      {id:2, name:"–û—Å–Ω–æ–≤–∞ #2", images:["https://picsum.photos/seed/bs2a/600/600","https://picsum.photos/seed/bs2b/600/600","https://picsum.photos/seed/bs2c/600/600"], price:7500, material:"–ü–ª–∞—Å—Ç–∏–∫", os:"Windows", connection:"–ë–µ—Å–ø—Ä–æ–≤–æ–¥–Ω–æ–µ", battery:"3200mAh", desc:"TKL, 2.4–ì—Ü/BT"},
      {id:3, name:"–û—Å–Ω–æ–≤–∞ #3", images:["https://picsum.photos/seed/bs3a/600/600","https://picsum.photos/seed/bs3b/600/600","https://picsum.photos/seed/bs3c/600/600"], price:7200, material:"–î–µ—Ä–µ–≤–æ", os:"macOS", connection:"–ü—Ä–æ–≤–æ–¥–Ω–æ–µ", battery:"‚Äî", desc:"Alice layout"},
      {id:4, name:"–û—Å–Ω–æ–≤–∞ #4", images:["https://picsum.photos/seed/bs4a/600/600","https://picsum.photos/seed/bs4b/600/600","https://picsum.photos/seed/bs4c/600/600"], price:8000, material:"–ê–ª—é–º–∏–Ω–∏–π", os:"Windows, macOS", connection:"–ë–µ—Å–ø—Ä–æ–≤–æ–¥–Ω–æ–µ", battery:"4000mAh", desc:"75%, gasket"},
      {id:5, name:"–û—Å–Ω–æ–≤–∞ #5", images:["https://picsum.photos/seed/bs5a/600/600","https://picsum.photos/seed/bs5b/600/600","https://picsum.photos/seed/bs5c/600/600"], price:6800, material:"–ü–ª–∞—Å—Ç–∏–∫", os:"Windows", connection:"–ü—Ä–æ–≤–æ–¥–Ω–æ–µ", battery:"‚Äî", desc:"60%, –∫–æ–º–ø–∞–∫—Ç"},
      {id:6, name:"–û—Å–Ω–æ–≤–∞ #6", images:["https://picsum.photos/seed/bs6a/600/600","https://picsum.photos/seed/bs6b/600/600","https://picsum.photos/seed/bs6c/600/600"], price:6900, material:"–î–µ—Ä–µ–≤–æ", os:"macOS", connection:"–ë–µ—Å–ø—Ä–æ–≤–æ–¥–Ω–æ–µ", battery:"3500mAh", desc:"75%, —ç—Ä–≥–æ–Ω–æ–º–∏—á–Ω–∞—è"}
    ]
  };

  /* =================== STATE =================== */
  const blocks = {
    keycaps: document.getElementById("keycaps-block"),
    switches: document.getElementById("switches-block"),
    bases: document.getElementById("bases-block"),
    delivery: document.getElementById("delivery-block")
  };

  const modal = document.getElementById("modal");
  const modalImg = document.getElementById("modal-img");
  const modalTitle = document.getElementById("modal-title");
  const modalMeta = document.getElementById("modal-meta");
  const modalAdd = document.getElementById("modal-add");
  const modalSound = document.getElementById("modal-sound");
  const btnPrev = document.getElementById("prev-btn");
  const btnNext = document.getElementById("next-btn");

  const cartModal = document.getElementById("cart");
  const orderKeycapImg = document.getElementById("order-keycap");
  const orderSwitchImg = document.getElementById("order-switch");
  const orderBaseImg = document.getElementById("order-base");
  const orderTotal = document.getElementById("order-total");

  const cartKeycap = document.getElementById("cart-keycap");
  const cartSwitch = document.getElementById("cart-switch");
  const cartBase = document.getElementById("cart-base");
  const cartTotal = document.getElementById("cart-total");

  let order = { keycap:null, switch:null, base:null, deliveryCost:300, paymentMethod:"crypto" };

  // Modal runtime
  let currentCategory = null; // 'keycaps' | 'switches' | 'bases'
  let currentItem = null;
  let images = [];
  let index = 0;
  let audio = null;

  /* =================== RENDERERS =================== */
  function renderGrid(category){
    const container = blocks[category];
    container.className = "block active"; // ensure visible when first nav click
    container.innerHTML = `
      <div class="grid" role="list" aria-label="${category}">
        ${data[category].slice(0,6).map(item=>{
          const img = item.images ? item.images[0] : item.img;
          const badgeClass = category==='keycaps'?'keycap':category==='switches'?'switch':'base';
          return `
            <article class="card" role="listitem" tabindex="0" aria-label="${item.name}">
              <div class="card-media">
                <span class="badge ${badgeClass}">${category==='keycaps'?'–ö–µ–π–∫–∞–ø':category==='switches'?'–°–≤–∏—Ç—á':'–û—Å–Ω–æ–≤–∞'}</span>
                <span class="price-tag">${item.price} ‚ÇΩ</span>
                <img src="${img}" alt="${item.name}" loading="lazy">
              </div>
              <div class="card-body">
                <div class="card-title">${item.name}</div>
                <button class="card-cta" data-category="${category}" data-id="${item.id}">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
              </div>
            </article>
          `;
        }).join('')}
      </div>
    `;

    // bind buttons
    container.querySelectorAll(".card-cta").forEach(btn=>{
      btn.addEventListener("click", (e)=>{
        e.stopPropagation();
        const cat = btn.getAttribute("data-category");
        const id = +btn.getAttribute("data-id");
        const item = data[cat].find(x=>x.id===id);
        openModal(cat, item);
      });
    });

    // open by Enter on card
    container.querySelectorAll(".card").forEach(card=>{
      card.addEventListener("keydown",(ev)=>{
        if(ev.key==="Enter"){ card.querySelector(".card-cta").click(); }
      });
    });
  }

  function ensureRendered(cat){
    const el = blocks[cat];
    if(!el.dataset.rendered){
      renderGrid(cat);
      el.dataset.rendered = "1";
    }
  }

  function showBlock(cat){
    Object.values(blocks).forEach(b=>b.classList.remove("active"));
    if(cat==="keycaps"||cat==="switches"||cat==="bases"){ ensureRendered(cat); }
    blocks[cat].classList.add("active");
    // scroll to section for nicer UX
    blocks[cat].scrollIntoView({behavior:"smooth", block:"start"});
  }

  /* =================== MODAL (Gallery & Switch) =================== */
  function openModal(cat, item){
    currentCategory = cat;
    currentItem = item;
    modalTitle.textContent = item.name;
    modalMeta.textContent = item.desc ? `${item.desc} ‚Ä¢ ${item.price} ‚ÇΩ` : `${item.price} ‚ÇΩ`;
    modalSound.style.display = "none";
    btnPrev.style.display = "none";
    btnNext.style.display = "none";
    audio = null;

    if(cat === "switches"){
      images = [item.img];
      index = 0;
      modalImg.src = images[0];
      modalSound.style.display = "inline-block";
      modalSound.onclick = ()=> {
        try{
          if(audio){ audio.pause(); audio.currentTime = 0; }
        }catch(e){}
        audio = new Audio(item.sound);
        audio.play();
      };
    } else {
      images = item.images.slice(0,3);
      index = 0;
      modalImg.src = images[0];
      btnPrev.style.display = "grid";
      btnNext.style.display = "grid";
    }

    modal.classList.add("active");
    document.body.style.overflow = "hidden"; // lock scroll

    // Keyboard navigation
    document.addEventListener("keydown", keyHandler);
    modalAdd.onclick = ()=>{
      addToOrder(cat, item);
      closeModal();
    };
  }

  function closeModal(){
    modal.classList.remove("active");
    document.body.style.overflow = "";
    try{ if(audio){ audio.pause(); } }catch(e){}
    document.removeEventListener("keydown", keyHandler);
  }

  function keyHandler(e){
    if(e.key==="Escape"){ closeModal(); }
    if(currentCategory!=="switches"){
      if(e.key==="ArrowRight"){ nextImage(); }
      if(e.key==="ArrowLeft"){ prevImage(); }
    }
  }

  function nextImage(){
    index = (index + 1) % images.length;
    modalImg.src = images[index];
  }
  function prevImage(){
    index = (index - 1 + images.length) % images.length;
    modalImg.src = images[index];
  }

  document.getElementById("modal-close").addEventListener("click", closeModal);
  btnNext.addEventListener("click", nextImage);
  btnPrev.addEventListener("click", prevImage);
  modal.addEventListener("click", (e)=>{ if(e.target===modal) closeModal(); });

  /* =================== ORDER / CART =================== */
  function addToOrder(cat, item){
    if(cat==="keycaps") order.keycap = item;
    if(cat==="switches") order.switch = item;
    if(cat==="bases") order.base = item;
    updateOrderSummary();
  }

  function updateOrderSummary(){
    orderKeycapImg.src = order.keycap ? order.keycap.images[0] : "";
    orderSwitchImg.src = order.switch ? order.switch.img : "";
    orderBaseImg.src = order.base ? order.base.images[0] : "";

    const sum = (order.keycap?.price || 0) + (order.switch?.price || 0) + (order.base?.price || 0) + (order.deliveryCost || 0);
    orderTotal.textContent = `–ò—Ç–æ–≥: ${sum} ‚ÇΩ`;

    // –æ–±–Ω–æ–≤–∏–º –≤—Å–ø–ª—ã–≤–∞—é—â—É—é –∫–æ—Ä–∑–∏–Ω—É
    cartKeycap.src = orderKeycapImg.src;
    cartSwitch.src = orderSwitchImg.src;
    cartBase.src = orderBaseImg.src;
    document.getElementById("cart-total").textContent = `–ò—Ç–æ–≥: ${sum} ‚ÇΩ`;
  }

  // Delivery & payment
  document.getElementById("delivery").addEventListener("change", (e)=>{
    order.deliveryCost = +e.target.value;
    updateOrderSummary();
  });
  document.querySelectorAll('input[name="payment"]').forEach(r => {
    r.addEventListener("change", (e)=>{ order.paymentMethod = e.target.value; });
  });

  // Cart modal
  document.getElementById("open-cart").addEventListener("click", ()=>{
    updateOrderSummary();
    cartModal.classList.add("active");
    document.body.style.overflow = "hidden";
  });
  document.getElementById("cart-close").addEventListener("click", ()=>{
    cartModal.classList.remove("active");
    document.body.style.overflow = "";
  });
  cartModal.addEventListener("click", (e)=>{ if(e.target===cartModal){ cartModal.classList.remove("active"); document.body.style.overflow=""; } });

  // Top menu buttons
  document.querySelectorAll(".menu .pill[data-block]").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const id = btn.getAttribute("data-block"); // e.g. keycaps-block
      const cat = id.replace("-block","");       // keycaps
      showBlock(cat);
    });
  });

  // Initial UI state
  showBlock("keycaps"); // –æ—Ç–∫—Ä—ã–≤–∞–µ–º –ø–µ—Ä–≤—É—é —Å–µ—Ç–∫—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  updateOrderSummary();
</script>
</body>
</html>
